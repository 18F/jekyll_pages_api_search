define(["angularAMD","liveSearch","lunr"],function(e,n,r){var t=angular.module("hubSearch",["LiveSearch"]);return t.factory("searchIndexPromise",["$http","$q",function(e,n){return e.get(SEARCH_BASEURL+"/search-index.json").then(function(e){return e.data})}]),t.factory("searchIndex",["searchIndexPromise",function(e){var n={};return e.then(function(e){n.url_to_doc=e.url_to_doc,n.index=r.Index.load(e.index)}),n}]),t.factory("pagesSearch",["searchIndex",function(e){return function(n){var r=e.index.search(n);return angular.forEach(r,function(n){var r=e.url_to_doc[n.ref];n.page=r,n.displayTitle=r.title||r.url}),r}}]),t.factory("searchUi",["$document",function(e){var n=function(e){return 191===e},r=function(e){var n=e.tagName.toLowerCase();return"input"===n},t=function(){var e=angular.element("#search1")[0];e.focus()},a=function(e){n(e.keyCode)&&!r(document.activeElement)&&(e.stopPropagation(),e.preventDefault(),t())};return{enableGlobalShortcut:function(){angular.element(e[0].body).on("keydown",a)},getSelectedResult:function(){var e=angular.element(".searchresultspopup").scope(),n=e.selectedIndex;return e.results[n]}}}]),t.controller("SearchController",["$scope","$q","searchUi","pagesSearch",function(e,n,r,t){r.enableGlobalShortcut();var a=function(e){return 13===e};e.searchKeyDown=function(e){if(a(e.keyCode)){var n=r.getSelectedResult();window.location=n.page.url}},e.searchCallback=function(e){var r=n.defer(),a=t(e.query);return r.resolve(a),r.promise}}]),e.bootstrap(t)});
